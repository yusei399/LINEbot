"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("@liff/ready"),r=require("@liff/is-logged-in"),n=require("@liff/util"),o=require("@liff/store"),i=require("@liff/extensions"),a=require("@liff/consts"),s=require("@liff/is-in-client"),c=require("@liff/logout"),l=require("@liff/is-sub-window"),u=require("@liff/sub-window"),f=require("@liff/server-api"),d=require("@liff/logger"),h=require("@liff/get-line-version"),g=require("@liff/native-bridge"),_=require("@liff/is-api-available"),p=require("@liff/get-os"),v=require("@liff/close-window"),I=require("@liff/message-bus"),w=require("@liff/hooks"),b=require("@liff/i18n"),m={iconColor:"#111111",statusBarColor:"BLACK",titleTextColor:"#111111",titleSubtextColor:"#B7B7B7",titleButtonColor:"#111111",titleBackgroundColor:"#FFFFFF",progressBarColor:"#06C755",progressBackgroundColor:"#FFFFFF",titleButtonAreaBackgroundColor:"#1FFFFFFF",titleButtonAreaBorderColor:"#26000000",baseBackgroundColor:"#FFFFFF",baseTextColor:"#000000",lightButtonBorderColor:"rgba(0, 0, 0, 0.15)"},C={iconColor:"#FFFFFF",statusBarColor:"WHITE",titleTextColor:"#FFFFFF",titleSubtextColor:"#949494",titleButtonColor:"#FFFFFF",titleBackgroundColor:"#111111",progressBarColor:"#06C755",progressBackgroundColor:"#111111",titleButtonAreaBackgroundColor:"#1FFFFFFF",titleButtonAreaBorderColor:"#26000000",baseBackgroundColor:"#000000",baseTextColor:"#FFFFFF",lightButtonBorderColor:"rgba(255, 255, 255, 0.5)"};function T(){var e;E("color-scheme",((null==(e=o.getContext())?void 0:e.menuColorSetting)||{adaptableColorSchemes:["light"]}).adaptableColorSchemes.join(" "));var t=window.matchMedia("(prefers-color-scheme: dark)");k({matches:null==t?void 0:t.matches,media:null==t?void 0:t.media}),t.addEventListener?t.addEventListener("change",k):t.addListener&&t.addListener(k)}function k(t){var r=o.getContext(),n=(null==r?void 0:r.menuColorSetting)||{adaptableColorSchemes:["light"],lightModeColor:m,darkModeColor:C},i=n.adaptableColorSchemes,a=n.lightModeColor,s=n.darkModeColor,c=i.includes("dark");t.matches&&c?F(e.__assign(e.__assign({},C),s)):F(e.__assign(e.__assign({},m),a))}function F(e){var t=e.iconColor,r=e.statusBarColor,o=e.titleTextColor,i=e.titleSubtextColor,a=e.titleButtonColor,s=e.titleBackgroundColor,c=e.progressBarColor,l=e.progressBackgroundColor,u=e.titleButtonAreaBackgroundColor,f=e.titleButtonAreaBorderColor,d=e.baseBackgroundColor,h=e.baseTextColor,g=e.lightButtonBorderColor;E("--liff-base-background-color",d),E("--liff-base-text-color",h),E("--liff-base-background-rgb-color",n.convertHexToRgb(d)),E("--liff-base-text-rgb-color",n.convertHexToRgb(h)),E("--liff-light-button-border-color",g),E("--liff-title-text-color",o),E("--liff-title-background-color",s),E("--liff-title-button-color",a),E("--liff-icon-color",t),E("--liff-status-bar-color",r),E("--liff-title-subtext-color",i),E("--liff-progress-bar-color",c),E("--liff-progress-background-color",l),E("--liff-title-button-area-background-color",n.convertArgbToRgba(u)),E("--liff-title-button-area-border-color",n.convertArgbToRgba(f))}function E(e,t){document.documentElement.style.setProperty(e,t)}function L(t){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return[4,i.load()];case 1:return e.sent().install(t),[2]}}))}))}function A(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return[4,f.fetch(f.getEndPoint("certs"))];case 1:return[2,e.sent()]}}))}))}function D(t,r,n){return e.__awaiter(this,void 0,void 0,(function(){var o;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,crypto.subtle.importKey("jwk",t,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])];case 1:return o=e.sent(),[4,crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,n,r)];case 2:return[2,e.sent()]}}))}))}function S(t,r){return e.__awaiter(this,void 0,void 0,(function(){var o,i,s,c,l,u,f,d,h,g,_,p,v,I,w,b;return e.__generator(this,(function(m){switch(m.label){case 0:return o=t.split("."),i=e.__read(o,3),s=i[0],c=i[1],l=i[2],u=JSON.parse(n.base64Url.decode(s)),f=JSON.parse(n.base64Url.decodeUnicode(c)),d=n.convertArrayBuffer(n.base64Url.decode(l)),h=n.convertArrayBuffer("".concat(s,".").concat(c)),[4,A()];case 1:if(g=m.sent(),!(_=g.keys.find((function(e){return e.kid===u.kid}))))return[3,6];if(delete _.alg,"ES256"!==u.alg)throw n.createLiffError(a.INVALID_ID_TOKEN,'Invalid "alg" value in ID_TOKEN');p=void 0,m.label=2;case 2:return m.trys.push([2,4,,5]),[4,D(_,h,d)];case 3:return p=m.sent(),[3,5];case 4:throw v=m.sent(),n.createLiffError(a.INVALID_ID_TOKEN,"".concat("Failed to use Crypto API to verify ID_TOKEN",": ").concat(v));case 5:if(p){if(I=f.iss!=="https://access.".concat("line.me"),w=f.aud!==r,b=1e3*f.exp<Date.now(),I)throw n.createLiffError(a.INVALID_ID_TOKEN,'Invalid "iss" value in ID_TOKEN');if(w)throw n.createLiffError(a.INVALID_ID_TOKEN,'Invalid "aud" value in ID_TOKEN');if(b)throw n.createLiffError(a.INVALID_ID_TOKEN,'Invalid "exp" value in ID_TOKEN');return[2,f]}throw n.createLiffError(a.INVALID_ID_TOKEN,"Invalid signature in ID_TOKEN");case 6:throw n.createLiffError(a.INVALID_ID_TOKEN,'Invalid "kid" value in ID_TOKEN');case 7:return[2]}}))}))}function N(e){var t=e.split(".");if(t[1])try{var r=t[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(window.atob(r))}catch(n){return null}return null}function y(e){var t=e.pathname,r=e.query,o=r?"?".concat(n.qs.stringify(r)):"",i="".concat("liff://").concat(t).concat(o);location.href=i}var B=null;function x(){"boolean"==typeof B&&d.logger.warn("liff.init is not expected to be called more than once"),B=!!o.getIsSubsequentLiffApp()||!(!s.isInClient()||n.qs.parse(window.location.hash).feature_token||o.getFeatureToken())&&(o.setIsSubsequentLiffApp(!0),!0)}function O(){return Boolean(B)}function U(t,r){return e.__awaiter(this,void 0,void 0,(function(){var n;return e.__generator(this,(function(e){switch(e.label){case 0:return(n=o.getMST())?[2,n]:t&&r?[4,u.getMSTByMSIT({msit:t,mstVerifier:r})]:[3,2];case 1:return[2,e.sent().mst];case 2:return[2,null]}}))}))}function q(e){return f.fetch("".concat(f.getEndPoint("apps"),"/").concat(e,"/featureToken"))}function W(t){return e.__awaiter(this,void 0,void 0,(function(){var i,a,s,c;return e.__generator(this,(function(e){switch(e.label){case 0:return i=n.qs.parse(window.location.hash),a=n.objectAssignKeyOnlyWithValue({access_token:o.getAccessToken(),context_token:o.getRawContext(),feature_token:o.getFeatureToken(),id_token:o.getIDToken(),client_id:o.getClientId(),mst_challenge:o.getMSTChallenge(),mst_verifier:o.getMSTVerifier(),msit:o.getMSIT()},i),O()?r.isLoggedIn()?[4,q(t)]:[3,2]:[3,3];case 1:s=e.sent().featureToken,a.feature_token||(a.feature_token=s),e.label=2;case 2:(c=n.extractChannelIdFromLiffId(t))&&(a.client_id=c),e.label=3;case 3:return[2,a]}}))}))}function M(e){if(e.persisted&&_.isApiAvailable("multipleLiffTransition"))if("ios"===p.getOS())window.location.reload();else{var t=o.getConfig().liffId,r=o.getFeatureToken();if(!t)throw n.createLiffError(a.INIT_FAILED,"Invalid LIFF ID.");if(!r)throw n.createLiffError(a.FORBIDDEN,"Invalid featureToken for client features");y({pathname:"app/".concat(t),query:{feature_token:r}})}}function P(t,r){return e.__awaiter(this,void 0,void 0,(function(){var o,i;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,f.verifyAccessToken(t)];case 1:return o=e.sent().client_id,i=n.extractChannelIdFromLiffId(r),[2,o===i]}}))}))}function K(t,i){var s,c;return e.__awaiter(this,void 0,void 0,(function(){var f,p,v,I,w,b,m,C,T,k,F,E,L;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){var t=h.getLineVersion();if(!t||n.compareVersion(t,"9.5.0")<0)e();else if(window._liff&&window._liff.features)e();else{d.logger.debug("cannot find window._liff.features, listen to ready event");var r=function(){d.logger.debug("ready event is fired"),g.removeListener("ready",r),e()};g.addListener("ready",r)}}))];case 1:return e.sent(),x(),[4,W(i.liffId)];case 2:if(f=e.sent(),p=f.access_token,v=f.context_token,I=f.feature_token,w=f.id_token,b=f.client_id,m=f.mst_verifier,C=f.mst_challenge,T=f.msit,v){if("string"!=typeof v)throw n.createLiffError(a.INIT_FAILED,"Cannot get context token, perhaps there is an incorrect parameter in permanent link");o.setContext(N(v))}if(void 0!==(null===(s=o.getContext())||void 0===s?void 0:s.liffId)&&(null===(c=o.getContext())||void 0===c?void 0:c.liffId)!==i.liffId)throw n.createLiffError(a.INIT_FAILED,"Invalid LIFF ID");return!l.isSubWindow()&&I&&(!function(e,t){_.isApiAvailable("multipleLiffTransition")&&y({pathname:"app/".concat(e),query:{feature_token:t}})}(i.liffId,I),O()&&o.setFeatureToken(I)),C&&o.setMSTChallenge(C),m&&o.setMSTVerifier(m),b&&o.setClientId(b),T&&o.setMSIT(T),window.addEventListener("pageshow",M),r.isLoggedIn()?[3,7]:I&&p?[3,5]:O()?(k=n.addParamsToUrl(location.href,{"liff.hback":"2"}),t.login({redirectUri:k}),[4,new Promise((function(){}))]):[3,4];case 3:e.sent(),e.label=4;case 4:throw t.login(),n.createLiffError(a.INIT_FAILED,"Failed to parse feature_token or access_token");case 5:return[4,P(p,i.liffId)];case 6:if(!e.sent())throw t.login(),n.createLiffError(a.INIT_FAILED,"Failed to verify access_token");o.setFeatureToken(I),o.setAccessToken(p),e.label=7;case 7:return[4,U(T,m)];case 8:return(F=e.sent())?(o.setMST(F),[4,u.getAppData({mst:F})]):[3,10];case 9:(E=e.sent().data)&&o.setAppData(JSON.stringify(E)),e.label=10;case 10:return w&&!o.getIDToken()&&o.setIDToken(w),w&&b&&!o.getDecodedIDToken()?[4,S(w,b)]:[3,12];case 11:(L=e.sent())&&o.setDecodedIDToken(L),e.label=12;case 12:return[2]}}))}))}function V(t){return e.__awaiter(this,void 0,void 0,(function(){var r,i,s,c,l,u,d;return e.__generator(this,(function(e){switch(e.label){case 0:return r=f.getEndPoint("apps"),i="".concat(r,"/").concat(t,"/contextToken"),s=o.getAccessToken(),c={"Content-Type":"application/json",Accept:"application/json"},s&&(c.Authorization="Bearer ".concat(s)),[4,f.fetch(i,{headers:c})];case 1:if(l=e.sent(),!(u=l.contextToken))throw n.createLiffError(a.INIT_FAILED,"Can not get context from server.");if(!(d=N(u)))throw n.createLiffError(a.INIT_FAILED,"Invalid context token.");return[2,d]}}))}))}function H(){return e.__awaiter(this,void 0,void 0,(function(){var t,r;return e.__generator(this,(function(e){switch(e.label){case 0:if(!(t=o.getConfig().liffId))throw n.createLiffError(a.INIT_FAILED,"Invalid LIFF ID.");return[4,V(t)];case 1:return r=e.sent(),o.setContext(r),[2]}}))}))}function R(t){return e.__awaiter(this,void 0,void 0,(function(){var r,i,a,s=this;return e.__generator(this,(function(c){switch(c.label){case 0:r=function(){return e.__awaiter(s,void 0,void 0,(function(){var r,i,a,s,c,l;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,(u=o.getConfig(),d=n.qs.parse(window.location.search),h=o.getLoginTmp(),g={grant_type:"authorization_code",client_id:d.liffClientId,appId:u.liffId,code:d.code,code_verifier:h.codeVerifier,redirect_uri:u.redirectUri||d.liffRedirectUri,id_token_key_type:"JWK"},_=n.qs.stringify(g),f.fetch(f.getEndPoint("token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:_}))];case 1:return r=e.sent(),i=r.access_token,a=r.id_token,s=r.expires_in,o.setClientId(t),o.setAccessToken(i),o.setExpireTime(new Date(Date.now()+1e3*s)),o.removeLoginTmp(),a?(o.setIDToken(a),[4,S(a,t)]):[3,3];case 2:(c=e.sent())&&o.setDecodedIDToken(c),e.label=3;case 3:return(l=n.qs.parse(location.hash).context_token)?(o.setContext(N(l)),[3,6]):[3,4];case 4:return[4,H()];case 5:e.sent(),e.label=6;case 6:return[2]}var u,d,h,g,_}))}))},c.label=1;case 1:return c.trys.push([1,3,,4]),[4,r()];case 2:return c.sent(),[3,4];case 3:throw i=c.sent(),a=i,o.removeLoginTmp(),a;case 4:return[2]}}))}))}function j(){return e.__awaiter(this,void 0,void 0,(function(){var t,i,s,c,l,f,d=this;return e.__generator(this,(function(h){switch(h.label){case 0:return(i=u.getMessageBus())?[3,2]:[4,u.initMessageBus(I.WINDOW.SUB)];case 1:i=h.sent(),h.label=2;case 2:return(t=i).isReady()?(s=n.randomAlphaNumericString(8),[4,t.getData("appData")]):[3,8];case 3:return c=h.sent(),l=c.eventName,f=c.data,l!==I.EVENT_NAME.NOT_FOUND?[3,6]:[4,t.teardown()];case 4:return h.sent(),[4,j()];case 5:return[2,h.sent()];case 6:f&&o.setAppData(JSON.stringify(f)),h.label=7;case 7:return t.listen((function(r){return e.__awaiter(d,void 0,void 0,(function(){var n,o;return e.__generator(this,(function(e){return n=r.context,o=n.data,n.eventName===a.SUB_WINDOW_STATUS.INIT&&(null==o?void 0:o.subWindowId)!==s&&v.closeWindow(),n.eventName!==a.SUB_WINDOW_STATUS.CANCEL&&n.eventName!==a.SUB_WINDOW_STATUS.SUBMIT||t.teardown(),[2]}))}))})),r.isLoggedIn()&&t.send({eventName:a.SUB_WINDOW_STATUS.INIT,data:{subWindowId:s,hasOpener:!!window.opener}}),[3,10];case 8:return u.getMainWindowOrigin()?[3,10]:[4,new Promise((function(e){window.addEventListener("message",function(e){return function t(r){var n=r.data,i=r.source,s=r.origin;if(n){var c=n.type,l=n.message;c===a.SUB_WINDOW_HEALTH_CHECK_MESSAGE&&(window.removeEventListener("message",t),l&&o.setAppData(l),u.setMainWindowOrigin(s),i&&i.postMessage&&i.postMessage({status:a.SUB_WINDOW_HEALTH_CHECK_MESSAGE},s),e())}}}(e))}))];case 9:return[2,h.sent()];case 10:return[2]}}))}))}var J=new(function(){function t(){var e=this;this.getAndValidateContext=function(){var e=o.getContext();if(!e)throw n.createLiffError(a.INIT_FAILED,"Could not get Context from server.");if(!e.endpointUrl)throw n.createLiffError(a.INIT_FAILED,"Could not get endpointUrl from server.");if(!e.permanentLinkPattern)throw n.createLiffError(a.INIT_FAILED,"Could not get permanentLinkPattern from server.");return e},this.decodeState=function(t){var r=e.getAndValidateContext();t=t.replace(/\n/g,"%0D%0A");var n=!r.endpointUrl.startsWith("/?")&&r.endpointUrl.includes("/?")||!r.endpointUrl.startsWith("/#")&&r.endpointUrl.includes("/#")||r.endpointUrl.endsWith("/")||!t.startsWith("/?")&&t.includes("/?")||!t.startsWith("/#")&&t.includes("/#")||t.endsWith("/"),o=new URL(r.endpointUrl),i=o.origin,a=o.pathname,s=o.search,c=new URL("".concat(i).concat(e.attachSlashAtStart(t))),l=c.pathname,u=c.search,f=c.hash,d="".concat(s).concat(s?u.replace(/\?/g,"&"):u),h="".concat(a).concat(e.attachSlashAtStart(l)).replace("//","/");return(h=e.attachSlashAtStart("".concat(h))).endsWith("/")&&!n&&(h=h.substring(0,h.length-1)),"".concat(i).concat(h).concat(d).concat(f).replace(/%0D%0A/g,"\n")}}return t.prototype.attachSlashAtStart=function(e){return"".concat(e&&e.length>0&&!e.startsWith("/")?"/":"").concat(e)},t.prototype.invoke=function(){return e.__awaiter(this,void 0,void 0,(function(){var t,r,o,i,s;return e.__generator(this,(function(e){switch(e.label){case 0:if(t=n.qs.parse(window.location.search),"string"!=typeof(r=t["liff.state"]))return[2];e.label=1;case 1:return e.trys.push([1,4,,5]),o=location.href,(i=this.decodeState(r))===o?[3,3]:(t["liff.hback"]?location.replace(n.addParamsToUrl(i,{"liff.hback":t["liff.hback"]})):location.replace(i),[4,new Promise((function(){}))]);case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if((s=e.sent()).code===a.INIT_FAILED)throw s;return d.logger.debug(s),[3,5];case 5:return[2]}}))}))},t}());function G(t,i,u){return e.__awaiter(this,void 0,void 0,(function(){var f;return e.__generator(this,(function(e){switch(e.label){case 0:if(!i.liffId)throw n.createLiffError(a.INVALID_CONFIG,"liffId is necessary for liff.init()");return o.setConfig(i),!s.isInClient()&&r.isLoggedIn()&&(o.getExpireTime()||c.logout()),f=n.qs.parse(window.location.search),!l.isSubWindow()||s.isInClient()?[3,2]:[4,j()];case 1:e.sent(),e.label=2;case 2:if(f.error&&f.liffOAuth2Error)throw g=f.error,_=f.error_description,p=_.replace(/\+/g," "),v="".concat(g,": ").concat(p),n.createLiffError(a.INIT_FAILED,v);return d=f.code,h=o.getLoginTmp(),Boolean(d&&!r.isLoggedIn()&&h&&h.codeVerifier)?[4,R(f.liffClientId)]:[3,4];case 3:e.sent(),e.label=4;case 4:return s.isInClient()?[4,K(t,i)]:[3,6];case 5:return e.sent(),[3,8];case 6:return r.isLoggedIn()?[3,8]:[4,H()];case 7:e.sent(),e.label=8;case 8:return[4,J.invoke()];case 9:return e.sent(),[4,u()];case 10:return e.sent(),n.replaceUrlCredentialRemoved(window.location.href),[2]}var d,h,g,_,p,v}))}))}var z=function(e,t){return new Promise((function(r,o){if(e){var i=document.createElement("script");i.type="module",i.onload=function(){r()},i.src=e,document.head.appendChild(i)}else o(n.createLiffError(a.INVALID_CONFIG,t))}))},Y=function(e){var t="https://static.line-scdn.net/lui/edge/versions/1.13.0/lui-alert.js";return t&&e&&(t=t.replace(/\d{1,2}\.\d{1,2}\.\d{1,3}/,e)),z(t,"LUI_ALERT_URL is not defined")},Q=function(){return e.__awaiter(void 0,void 0,void 0,(function(){var t;return e.__generator(this,(function(e){switch(e.label){case 0:return t=function(){var e,t=document.querySelector('script[src*="luivendor.js"]');if(t&&(null===(e=t.src.match(/\d{1,2}\.\d{1,2}\.\d{1,3}/g))||void 0===e?void 0:e.length))return t.src.match(/\d{1,2}\.\d{1,2}\.\d{1,3}/g)[0]}(),t?[3,2]:[4,z("https://static.line-scdn.net/lui/edge/versions/1.13.0/luivendor.js","LUI_VENDOR_URL is not defined")];case 1:e.sent(),e.label=2;case 2:return[4,Y(t)];case 3:return e.sent(),[4,(r=n.randomAlphaNumericString(6),new Promise((function(){var e=document.createElement("div");e.innerHTML='<lui-alert id="'.concat("liffAlert","-").concat(r,'" shown title="').concat(b.t("alert.android.extBrowser.autoLoginWorkaround.title"),'" message="').concat(b.t("alert.android.extBrowser.autoLoginWorkaround.desc"),'" button="').concat(b.t("alert.android.extBrowser.autoLoginWorkaround.button.text"),'"></lui-alert>'),document.body.appendChild(e);var t=document.getElementById("".concat("liffAlert","-").concat(r));t&&t.addEventListener("lui-button-click",(function(){var e=window.open("".concat(window.location.href,"&liffIsEscapedFromApp=true"),"_blank");e&&(e.location.href="".concat(window.location.href,"&liffIsEscapedFromApp=true"),window.close())}))})))];case 4:return e.sent(),[2]}var r}))}))};function X(){return e.__awaiter(this,void 0,void 0,(function(){var t;return e.__generator(this,(function(e){switch(e.label){case 0:return s.isInClient()||"android"!==p.getOS()||((t=n.qs.parse(window.location.search))[I.IDENTIFIER_KEY]||t.liffIsEscapedFromApp)?[3,6]:t.liffClientId&&document.referrer.includes("access.".concat("line.me"))?(window.location.href="".concat(window.location.href,"&liffIsEscapedFromApp=true"),[2]):t.liffClientId&&document.referrer.includes("android-app://")?[4,Q()]:[3,2];case 1:e.sent(),e.label=2;case 2:return t.liffClientId&&""===document.referrer&&1===window.history.length?[4,Q()]:[3,4];case 3:e.sent(),e.label=4;case 4:return!document.referrer.includes("liffClientId")||document.referrer.includes("liffIsEscapedFromApp")?[3,6]:[4,Q()];case 5:e.sent(),e.label=6;case 6:return[2]}}))}))}var Z=function(){function n(){this.hooks={before:new w.AsyncHook,after:new w.AsyncHook},this.internalHooks={beforeFinished:new w.AsyncHook,beforeSuccess:new w.AsyncHook,error:new w.AsyncHook}}return Object.defineProperty(n.prototype,"name",{get:function(){return"init"},enumerable:!1,configurable:!0}),n.prototype.install=function(e){var t=e.liff;return this.liff=t,this.init.bind(this)},n.prototype.init=function(n,o,i){return e.__awaiter(this,void 0,void 0,(function(){var a;return e.__generator(this,(function(e){switch(e.label){case 0:return[4,this.hooks.before.call()];case 1:e.sent(),s=this.liff,window&&!window.liff&&(window.liff=s),e.label=2;case 2:return e.trys.push([2,9,,11]),[4,Promise.all([L(this.liff),G(this.liff,n,this.internalHooks.beforeFinished.call)])];case 3:return e.sent(),T(),[4,this.internalHooks.beforeSuccess.call()];case 4:return e.sent(),!n.withLoginOnExternalBrowser||r.isLoggedIn()?[3,6]:(this.liff.login(),[4,new Promise((function(){}))]);case 5:e.sent(),e.label=6;case 6:return[4,X()];case 7:return e.sent(),[4,this.hooks.after.call()];case 8:return e.sent(),"function"==typeof o&&o(),t.done(),[3,11];case 9:return a=e.sent(),[4,this.internalHooks.error.call(a)];case 10:throw e.sent(),"function"==typeof i&&i(a),a;case 11:return[2]}var s}))}))},n}();exports.InitModule=Z;
